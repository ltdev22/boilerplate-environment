LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
LoadModule rewrite_module modules/mod_rewrite.so

<VirtualHost *:80>
    ServerAdmin webmaster@${WEB_SERVER_ALIAS}
    ServerName ${WEB_SERVER_NAME}
    ServerAlias ${WEB_SERVER_ALIAS}
    DocumentRoot ${WEB_SERVER_DOCUMENT_ROOT}

    # Proxy .php requests to port 9000 of the php-fpm container
    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://php:${PHP_PORT}"
    </FilesMatch>

    <Directory ${WEB_SERVER_DOCUMENT_ROOT}>
        DirectoryIndex index.php index.html index.htm
        Options Indexes FollowSymLinks
        Options +FollowSymLinks
        AllowOverride All
        Require all granted

        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.php [QSA,L]
    </Directory>

    ErrorLog "/var/log/apache2/error_log"
    CustomLog "/var/log/apache2/access_log" common
</VirtualHost>